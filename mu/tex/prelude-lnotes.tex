\def\emcolor{\darkred}
\def\code{\darkgreen\tt}

\input{prelude-context.tex}

\setuppapersize[A4][A4]
\setuppagenumbering[alternative=doublesided]

\setuplayout
  [width=fit,
   backspace=20mm,
   topspace=15mm,
   bottomspace=8mm,
   footer=8mm,
   margin=65mm]

\setupfootnotes
  [bodyfont=\footsize,
   location=bottom,
   rule=off,
   before={\blank\hrule\blank[small]}]

\definemixedcolumns
  [sectioncolumns]
  [n=2,
   balance=yes,
   distance=24pt,
   separator=rule,
   rulethickness=.5pt,
   rulecolor=gray]

\setuphead
  [section]
  [style={\switchtobodyfont[\sectionsize]},
   before={\blank[2*big]},
   after={\blank[10pt]},
   aftersection={}]

\setuphead
  [subsection]
  [style={\switchtobodyfont[\subsectionsize]},
   before={\blank[10pt]},
   after={\blank[big]},
   align=right,
   margin=0pt,
   sectionstarter=]

\setuphead
  [subsubsection]
  [style={\switchtobodyfont[\subsubsectionsize]\realbf},
   numberstyle={\sectionbar},
   textdistance=3pt,
   distance=3pt]

\definemargindata
  [summary]
  [style=\notefont,location=outer,width=58mm,align=flushleft,distance=3.5mm,stack=continue]

\setupitemize
  [distance=-2pt,
   before={\blank[3pt]},
   after={\blank[3pt]}]

\definestartstop[SynSnippetKeyword]  [\c!color=darkred,\c!style=boldface]
\definestartstop[SynSnippetOperator] [\c!color=darkyellow]
\definestartstop[SynSnippetBoundary] [\c!color=darkcyan,\c!style=boldface]
\definestartstop[SynSnippet]         [DefaultSnippet]
\definestartstop[SynSnippetName]     [\c!color=,before={\it}]
\definestartstop[SynSnippetType]     [\c!color=darkblue]
\definestartstop[SynSnippetMagic]    [\c!color=darkmagenta]
\definestartstop[SynSnippetQuote]    [\c!color=darkgreen]
\definestartstop[SynSnippetString]   [\c!color=darkgreen]
\definestartstop[SynSnippetComment]  [\c!color=brownish]

\starttext

\switchtobodyfont[\notesize]

\startnarrow[right=-6cm,left=0pt][right]

  \startalignment[center]
    \switchtobodyfont[\titlesize]      \mmtitle   \blank[small]
    \switchtobodyfont[\subsectionsize] \mmauthors \blank[big]
  \stopalignment

  \setupcombinedlist[content][list={section}, alternative=c,]
  \setuplist[section][width=12mm]
  \blank[big]

  \startsectioncolumns
    \placecontent
  \stopsectioncolumns

\stopnarrow
