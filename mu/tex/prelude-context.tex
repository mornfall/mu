\setuplayout
  [width=middle,
   height=middle,
   grid=no,
   header=0cm]

\setuphead
  [section]
  [align=center,
   sectionnumber=yes,
   placehead=yes,
   page=no,
   aftersection={},
   sectionstarter=\str!part\ ,
   sectionstopper=:,
   number=yes]

\setuphead
  [subsection]
  [before={},
   after={\blank[big]},
   aftersection={}]

\setuphead
  [subsubsection]
  [alternative=text,
   before={\blank[small]},
   after={},
   aftersection={},
   sectionstarter={},
   sectionstopper={},
   aligntitle=float]

\definebar[sectionbar][rulethickness=.5pt, offset=-0.25]

\def\beforetable{\blank[small]\strut\hfill}
\def\aftertable{\hfill\strut\blank[small]}
\def\beforepicture{\blank[big]\strut\hfill}
\def\afterpicture{\hfill\strut\blank[medium]}

\def\footfont{\switchtobodyfont[sans, \footsize]}
\def\notefont{\switchtobodyfont[sans, 7.5pt]}
\def\foottext{\rlap{\mmtitle}\hfill\pagenumber/\lastpagenumber\hfill\llap{\currentdate}}

\setcounter         [userpage] [1]
\setupfooter        [state=start]
\setuppagenumbering [state=start]
\setupfootertexts   [{\footfont{\foottext}}]

\setuptyping
  [before={\switchtobodyfont[\codesize]\blank[8pt]},
   after={\blank[8pt]}]

\input{prelude-typescript.tex}
\input{prelude-strings.tex}
\input{prelude-style.tex}

\language[\mmlang]

%
% colors
%

\definecolor[blackcoffee] [r=0.10, g=.040, b=.02]
\definecolor[coffee]      [r=0.70, g=.290, b=.15]
\definecolor[dark]        [r=0.27, g=.270, b=.27]
\definecolor[lightcoffee] [r=0.98, g=.406, b=.21]
\definecolor[brownish]    [r=0.60, g=.300, b=.10]
\definecolor[midgreen]    [r=0.20, g=.800, b=.20]

\definecolor[fgteal] [r=0.10, g=0.60, b=0.60]
\definecolor[fgblue] [r=0.10, g=0.10, b=0.60]
\definecolor[fgred] [r=0.60, g=0.10, b=0.10]
\definecolor[fggreen] [r=0.10, g=0.60, b=0.10]
\definecolor[fgyellow] [r=0.60, g=0.60, b=0.10]

%
% source code syntax highlighting
%

\definestartstop[SynSnippetKeyword]  [\c!style=boldface]
\definestartstop[SynSnippetOperator] []
\definestartstop[SynSnippetBoundary] [] % [\c!style=boldface]
\definestartstop[SynSnippet]         [DefaultSnippet]
\definestartstop[SynSnippetName]     [\c!style=slanted] % this is a terrible hack to get sans-serif
\definestartstop[SynSnippetType]     [\c!style=boldface]
\definestartstop[SynSnippetMagic]    []
\definestartstop[SynSnippetQuote]    []
\definestartstop[SynSnippetString]   []
\definestartstop[SynSnippetComment]  [\c!style=italic]

\registerctxluafile{syn-cxx.lua}    {1.001}
\registerctxluafile{syn-python.lua} {1.001}
\registerctxluafile{syn-llvm.lua}   {1.001}
\registerctxluafile{syn-shell}      {1.001}

\let\center\raggedcenter

%
% metapost graphics
%

\startMPinclusions[+]
input roundrect;
color fg, shade_a, shade_b, shade_c, shade_d, fg_a, fg_b, fg_c, fg_d, fg_e;
fg := black;

fg_a := (0.10, 0.60, 0.60);
fg_b := (0.10, 0.10, 0.60);
fg_c := (0.60, 0.10, 0.10);
fg_d := (0.10, 0.60, 0.10);
fg_e := (0.60, 0.60, 0.10);

shade_d := (0.52, 0.52, 0.52);
shade_c := (0.64, 0.64, 0.64);
shade_b := (0.76, 0.76, 0.76);
shade_a := (0.88, 0.88, 0.88);
picture dotted;
dotted := dashpattern( on 1 off 1.5 );
\stopMPinclusions
